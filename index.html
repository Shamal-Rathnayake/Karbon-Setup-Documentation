<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Server Setup Guide</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
    />
    <script src="/_sdk/element_sdk.js"></script>
    <style>
      body {
        box-sizing: border-box;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Inter", system-ui, -apple-system, sans-serif;
        line-height: 1.6;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #e2e8f0;
        overflow-x: hidden;
        scroll-behavior: smooth;
      }

      .toc {
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 3rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      }

      .toc h2 {
        font-size: 1.5rem;
        margin-top: 0;
        margin-bottom: 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 1rem;
        color: #f093fb;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .toc ul {
        list-style: none;
        margin-left: 0;
        margin-bottom: 0;
        padding-left: 0;
      }

      .toc > ul > li {
        margin-bottom: 0.5rem;
      }

      .toc a {
        color: #cbd5e1;
        text-decoration: none;
        transition: all 0.2s ease;
        display: block;
        padding: 0.5rem 0.75rem;
        border-radius: 8px;
        font-size: 1rem;
        border: 1px solid transparent;
      }

      .toc > ul > li > a {
        font-weight: 600;
      }

      .toc a:hover {
        color: #fff;
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.05);
        transform: translateX(4px);
      }

      /* Nested items */
      .toc ul ul {
        margin-left: 0.75rem;
        margin-top: 0.25rem;
        padding-left: 1rem;
        border-left: 2px solid rgba(255, 255, 255, 0.1);
      }

      .toc ul ul li {
        margin-bottom: 0.25rem;
      }

      .toc ul ul a {
        font-size: 0.9rem;
        color: #94a3b8;
        padding: 0.35rem 0.75rem;
      }

      .toc ul ul a:hover {
        color: #e2e8f0;
        background: rgba(255, 255, 255, 0.05);
      }

      .wrapper {
        width: 100%;
        min-height: 100%;
        overflow-y: auto;
        padding: 3rem 1.5rem;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background: rgba(30, 41, 59, 0.95);
        border-radius: 16px;
        padding: 3rem;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
      }

      h1 {
        font-size: 2.75rem;
        font-weight: 800;
        margin-bottom: 1rem;
        background: linear-gradient(135deg, #667eea 0%, #f093fb 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        letter-spacing: -0.5px;
      }

      .subtitle {
        font-size: 1.125rem;
        color: #94a3b8;
        margin-bottom: 3rem;
        font-weight: 400;
      }

      h2 {
        font-size: 1.875rem;
        font-weight: 700;
        margin-top: 3rem;
        margin-bottom: 1.5rem;
        color: #f093fb;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid rgba(240, 147, 251, 0.2);
      }

      h3 {
        font-size: 1.375rem;
        font-weight: 600;
        margin-top: 2rem;
        margin-bottom: 1rem;
        color: #a78bfa;
      }

      p,
      li {
        color: #cbd5e1;
        margin-bottom: 0.75rem;
        font-size: 1rem;
      }

      ul {
        margin-left: 1.5rem;
        margin-bottom: 1.5rem;
      }

      li {
        margin-bottom: 0.5rem;
      }

      .code-block {
        margin: 1.5rem 0;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }

      .code-header {
        background: #1e293b;
        padding: 0.75rem 1.25rem;
        border-bottom: 1px solid #334155;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .code-header::before {
        content: "";
        width: 12px;
        height: 12px;
        background: #ef4444;
        border-radius: 50%;
        box-shadow: 18px 0 0 #f59e0b, 36px 0 0 #10b981;
      }

      .code-label {
        font-size: 0.875rem;
        color: #64748b;
        font-family: "Monaco", "Courier New", monospace;
        margin-left: 2.5rem;
      }

      pre {
        margin: 0 !important;
        background: #0f172a !important;
        padding: 1.5rem !important;
        overflow-x: auto;
      }

      pre code {
        font-family: "Monaco", "Courier New", monospace;
        font-size: 0.9rem;
        line-height: 1.6;
      }

      .warning-box {
        background: rgba(251, 191, 36, 0.1);
        border-left: 4px solid #fbbf24;
        padding: 1.25rem;
        margin: 1.5rem 0;
        border-radius: 8px;
      }

      .warning-box p {
        color: #fde68a;
        margin: 0;
      }

      .info-box {
        background: rgba(59, 130, 246, 0.1);
        border-left: 4px solid #3b82f6;
        padding: 1.25rem;
        margin: 1.5rem 0;
        border-radius: 8px;
      }

      .info-box p {
        color: #93c5fd;
        margin: 0;
      }

      .step-number {
        display: inline-block;
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 50%;
        text-align: center;
        line-height: 32px;
        font-weight: 700;
        margin-right: 0.75rem;
        font-size: 0.875rem;
      }

      .optional {
        font-weight: 700;
        font-size: 0.875rem;
        padding-left: 1.5rem;
        padding-top: 1rem;
      }

      @media (max-width: 768px) {
        .container {
          padding: 2rem 1.5rem;
        }

        h1 {
          font-size: 2rem;
        }

        h2 {
          font-size: 1.5rem;
        }

        h3 {
          font-size: 1.25rem;
        }

        .wrapper {
          padding: 2rem 1rem;
        }

        .toc {
          padding: 1.5rem;
        }

        .back-to-top {
          bottom: 1rem;
          right: 1rem;
          width: 2.5rem;
          height: 2.5rem;
        }

        .code-header {
          padding: 0.5rem 1rem;
        }
      }

      .footer {
        text-align: center;
        padding: 2rem 0 0 0;
        color: rgba(255, 255, 255, 0.6);
        font-size: 0.75rem;
        font-weight: 500;
        font-family: "Inter", sans-serif;
      }

      .copy-btn {
        margin-left: auto;
        background-color: #3b82f6;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 0.5rem;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        font-family: "Inter", sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 32px;
        min-height: 32px;
      }

      .copy-btn:hover {
        background-color: #2563eb;
      }

      .copy-btn.success {
        background-color: #10b981;
      }

      .copy-btn.error {
        background-color: #ef4444;
      }

      .back-to-top {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 1000;
      }

      .back-to-top.visible {
        opacity: 1;
        visibility: visible;
      }

      .back-to-top:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
      }
    </style>
    <style>
      @view-transition {
        navigation: auto;
      }
    </style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  </head>

  <body>
    <div class="wrapper">
      <div class="container">
        <h1>Karbon Server Setup Guide</h1>
        <p class="subtitle">Setup Ubuntu servers for running Karbon AI</p>

        <nav class="toc">
          <h2>Table of Contents</h2>
          <ul>
            <li>
              <a href="#initial-system-setup">Initial System Setup</a>
              <ul>
                <li>
                  <a href="#update-and-upgrade-packages">Follow initial setup guide</a>
                  <ul>
                    <li><a href="#navigate-to-home-directory">Navigate to home directory</a></li>
                    <li><a href="#create-new-directory">Create new directory</a></li>
                    <li><a href="#navigate-to-new-directory">Navigate to new directory</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li>
              <a href="#setup-karbon-ai-currency-be">Setup Karbon AI Currency BE</a>
              <ul>
                <li><a href="#clone-karbon-ai-currency-be">Clone Karbon AI Currency BE</a></li>
                <li>
                  <a href="#navigate-into-karbon-ai-currency-be"
                    >Navigate into Karbon AI Currency BE</a
                  >
                </li>
                <li><a href="#install-dependencies-currency">Install dependencies</a></li>
                <li><a href="#create-env-file-currency">Create the .env file</a></li>
                <li><a href="#switch-to-staging-branch-currency">Switch to staging branch</a></li>
                <li><a href="#run-index-js-currency">Run index.js file with PM2</a></li>
                <li>
                  <a href="#run-bybit-currency"
                    >Run Bybit platform market file as a cron job with PM2</a
                  >
                </li>
                <li>
                  <a href="#run-bitget-currency"
                    >Run Bitget platform market file as a cron job with PM2</a
                  >
                </li>
              </ul>
            </li>
            <li>
              <a href="#setup-karbon-ai-be">Setup Karbon AI BE</a>
              <ul>
                <li><a href="#navigate-to-karbon-directory">Navigate to karbon directory</a></li>
                <li><a href="#clone-karbon-ai-be">Clone Karbon AI BE</a></li>
                <li><a href="#navigate-into-karbon-ai-be">Navigate into Karbon AI BE</a></li>
                <li>
                  <a href="#setup-karbon-ai-be-v4">Setup Karbon AI BE V4</a>
                  <ul>
                    <li>
                      <a href="#switch-to-staging-branch-v4">Switch to staging branch (V4)</a>
                    </li>
                    <li><a href="#install-dependencies-v4">Install dependencies</a></li>
                    <li><a href="#create-env-file-v4">Create the .env file</a></li>
                    <li><a href="#run-main-server-v4">Run main server with PM2</a></li>
                    <li><a href="#run-user-server-v4">Run user server with PM2 (Production)</a></li>
                    <li><a href="#run-take-action-v4">Run take action script with PM2</a></li>
                    <li><a href="#run-pnl-script-v4">Run pnl script with PM2</a></li>
                    <li><a href="#run-temp-trade-v4">Run temp trade script with PM2</a></li>
                    <li><a href="#run-backup-v4">Run backup script with PM2</a></li>
                    <li>
                      <a href="#run-trade-open-status-v4">Run trade open status script with PM2</a>
                    </li>
                    <li><a href="#run-watch-tp-v4">Run watch tp script with PM2</a></li>
                    <li><a href="#run-pnl-close-v4">Run pnl close script with PM2</a></li>
                    <li>
                      <a href="#run-hedge-close-v4"
                        >Run hedge close by percentage script with PM2</a
                      >
                    </li>
                    <li><a href="#run-trailing-stop-v4">Run trailing stop script with PM2</a></li>
                    <li><a href="#run-stop-loss-v4">Run stop loss script with PM2</a></li>
                  </ul>
                </li>
                <li>
                  <a href="#setup-karbon-ai-be-v5">Setup Karbon AI BE V5</a>
                  <ul>
                    <li>
                      <a href="#switch-to-staging-branch-v5">Switch to staging branch (V5)</a>
                    </li>
                    <li><a href="#install-dependencies-v5">Install dependencies</a></li>
                    <li><a href="#create-env-file-v5">Create the .env file</a></li>
                    <li><a href="#setup-redis-docker-v5">Setup Redis with Docker</a></li>
                    <li><a href="#run-main-server-v5">Run main server with PM2</a></li>
                    <li><a href="#run-user-server-v5">Run user server with PM2 (Production)</a></li>
                    <li><a href="#run-take-action-v5">Run take action script with PM2</a></li>
                    <li><a href="#run-pnl-script-v5">Run pnl script with PM2</a></li>
                    <li><a href="#run-temp-trade-v5">Run temp trade script with PM2</a></li>
                    <li><a href="#run-backup-v5">Run backup script with PM2</a></li>
                    <li>
                      <a href="#run-trade-open-status-v5">Run trade open status script with PM2</a>
                    </li>
                    <li><a href="#run-pnl-close-v5">Run pnl close script with PM2</a></li>
                    <li>
                      <a href="#run-hedge-close-v5"
                        >Run hedge close by percentage script with PM2</a
                      >
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
            <li>
              <a href="#setup-karbon-ai-admin-fe">Setup Karbon AI Admin FE</a>
              <ul>
                <li>
                  <a href="#navigate-to-karbon-directory-admin">Navigate to karbon directory</a>
                </li>
                <li><a href="#clone-karbon-ai-admin-fe">Clone Karbon AI Admin FE</a></li>
                <li>
                  <a href="#navigate-into-karbon-ai-admin-fe">Navigate into Karbon AI Admin FE</a>
                </li>
                <li><a href="#switch-to-staging-branch-admin">Switch to staging branch</a></li>
                <li><a href="#add-site-to-apache-admin">Add site to Apache</a></li>
                <li><a href="#enable-site-admin">enable</a></li>
              </ul>
            </li>
            <li>
              <a href="#setup-karbon-ai-fe">Setup Karbon AI FE</a>
              <ul>
                <li><a href="#navigate-to-karbon-directory-fe">Navigate to karbon directory</a></li>
                <li><a href="#clone-karbon-ai-fe">Clone Karbon AI FE</a></li>
                <li><a href="#navigate-into-karbon-ai-fe">Navigate into Karbon AI FE</a></li>
                <li><a href="#switch-to-staging-branch-fe">Switch to staging branch</a></li>
                <li><a href="#add-site-to-apache-fe">Add site to Apache</a></li>
                <li><a href="#enable-site-fe">enable</a></li>
              </ul>
            </li>
          </ul>
        </nav>
        <h2 id="initial-system-setup">Initial System Setup</h2>
        <h3 id="update-and-upgrade-packages">Follow initial setup guide</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">https://shamal-rathnayake.github.io/server-setup-guide</code></pre>
        </div>
        <p id="navigate-to-home-directory">Navigate to home directory:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">cd ~/var/www</code></pre>
        </div>
        <p id="create-new-directory">Create new directory:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">mkdir karbon-ai</code></pre>
        </div>
        <p id="navigate-to-new-directory">Navigate to new directory:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">cd karbon-ai</code></pre>
        </div>
        <h2 id="setup-karbon-ai-currency-be">Setup Karbon AI Currency BE</h2>
        <p id="clone-karbon-ai-currency-be">Clone Karbon AI Currency BE:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">git clone https://github.com/spera-labs/karbon-ai-currency-be.git </code></pre>
        </div>
        <p id="navigate-into-karbon-ai-currency-be">Navigate into Karbon AI Currency BE:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">cd karbon-ai-currency-be</code></pre>
        </div>
        <p id="install-dependencies-currency">Install dependencies:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">npm install</code></pre>
        </div>
        <p id="create-env-file-currency">Create the .env file:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">touch .env</code></pre>
        </div>
        <p id="switch-to-staging-branch-currency">Switch to staging branch:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">git checkout &lt;STAGING BRANCH NAME&gt;</code></pre>
        </div>
        <p id="run-index-js-currency">Run index.js file with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start index.js --name=currency-24h --max-memory-restart 300M</code></pre>
        </div>
        <p id="run-bybit-currency">Run Bybit platform market file as a cron job with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start server.bybit.js --name=currency-bybit --max-memory-restart 300M --cron-restart="*/10 * * * *"</code></pre>
        </div>
        <p id="run-bitget-currency">Run Bitget platform market file as a cron job with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start server.bitget.js --name=currency-bitget --max-memory-restart 300M --cron-restart="*/10 * * * *"</code></pre>
        </div>

        <h2 id="setup-karbon-ai-be">Setup Karbon AI BE</h2>
        <p id="navigate-to-karbon-directory">Navigate to karbon directory:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">cd /var/www/karbon-ai</code></pre>
        </div>
        <p id="clone-karbon-ai-be">Clone Karbon AI BE:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">git clone https://github.com/spera-labs/karbon-ai-be-new.git</code></pre>
        </div>
        <p id="navigate-into-karbon-ai-be">Navigate into Karbon AI BE:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">cd karbon-ai-be-new</code></pre>
        </div>
        <h3 id="setup-karbon-ai-be-v4">Setup Karbon AI BE V4</h3>
        <p id="switch-to-staging-branch-v4">Switch to staging branch (V4):</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">git checkout &lt;STAGING BRANCH NAME&gt;</code></pre>
        </div>
        <p id="install-dependencies-v4">Install dependencies:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">npm install</code></pre>
        </div>
        <p id="create-env-file-v4">Create the .env file:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">touch .env</code></pre>
        </div>

        <p id="run-main-server-v4">Run main server with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start index.js --name=karbon-main --max-memory-restart 1000M</code></pre>
        </div>
        <p id="run-user-server-v4">
          Run user server with PM2 <strong>(For Production Environment)</strong>:
        </p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start index_user.js --name=karbon-user-main --max-memory-restart 1000M</code></pre>
        </div>
        <p id="run-take-action-v4">Run take action script with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/karbon-ai-take-action.js --name=karbon-take-action --max-memory-restart 400M</code></pre>
        </div>
        <p id="run-pnl-script-v4">Run pnl script with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/trade-pnl.js --name=karbon-trade-pnl --max-memory-restart 400M</code></pre>
        </div>
        <p id="run-temp-trade-v4">Run temp trade script with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/delete-temp-trade.js --name=karbon-delete-temp-trade --max-memory-restart 400M</code></pre>
        </div>
        <p id="run-backup-v4">Run backup script with PM2:</p>
        <div class="info-box">
          <p>For setting up backup process, follow the documentation of the library</p>
          <div class="code-block">
            <div class="code-header"><span class="code-label">apache</span></div>
            <pre><code class="language-apache">https://www.npmjs.com/package/mongodb-backup-cloud</code></pre>
          </div>
        </div>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/backup-db.js --name=karbon-db-backup --max-memory-restart 400M</code></pre>
        </div>
        <p id="run-trade-open-status-v4">Run trade open status script with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/trade-open-status.js --name=karbon-trade-open-status --max-memory-restart 400M</code></pre>
        </div>
        <p id="run-watch-tp-v4">Run watch tp script with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/watch-tp-order.js --name=karbon-watch-tp-order --max-memory-restart 400M</code></pre>
        </div>
        <p id="run-pnl-close-v4">Run pnl close script with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/hedge-pnl-close-watch.js --name=karbon-hedge-pnl-close --max-memory-restart 500M</code></pre>
        </div>
        <p id="run-hedge-close-v4">Run hedge close by percentage script with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/hedge-close-by-percentage.js --name=karbon-hedge-pnl-close-by-percentage --max-memory-restart 500M</code></pre>
        </div>
        <p id="run-trailing-stop-v4">Run trailing stop script with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/watch-trailing-stop-order.js --name=karbon-trailing-watch --max-memory-restart 3000M</code></pre>
        </div>
        <p id="run-stop-loss-v4">Run stop loss script with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/watch-stop-loss-order.js --name=karbon-sl-watch --max-memory-restart 400M</code></pre>
        </div>
        <h3 id="setup-karbon-ai-be-v5">Setup Karbon AI BE V5</h3>
        <p id="switch-to-staging-branch-v5">Switch to staging branch (V5):</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">git checkout &lt;STAGING BRANCH NAME&gt;</code></pre>
        </div>
        <p id="install-dependencies-v5">Install dependencies:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">npm install</code></pre>
        </div>
        <p id="create-env-file-v5">Create the .env file:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">touch .env</code></pre>
        </div>
        <p id="setup-redis-docker-v5">Setup Redis with Docker:</p>
        <div class="info-box">
          <p>For setting up Redis with Docker, follow initial setup guide</p>
          <div class="code-block">
            <div class="code-header"><span class="code-label">apache</span></div>
            <pre><code class="language-apache">https://shamal-rathnayake.github.io/server-setup-guide</code></pre>
          </div>
        </div>
        <p id="run-main-server-v5">Run main server with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start index.js --name=karbon-main --max-memory-restart 1000M</code></pre>
        </div>
        <p id="run-user-server-v5">
          Run user server with PM2 <strong>(For Production Environment)</strong>:
        </p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start index_user.js --name=karbon-user-main --max-memory-restart 1000M</code></pre>
        </div>
        <p id="run-take-action-v5">Run take action script with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/karbon-ai-take-action.js --name=karbon-take-action --max-memory-restart 400M</code></pre>
        </div>
        <p id="run-pnl-script-v5">Run pnl script with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/trade-pnl.js --name=karbon-trade-pnl --max-memory-restart 400M</code></pre>
        </div>
        <p id="run-temp-trade-v5">Run temp trade script with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/delete-temp-trade.js --name=karbon-delete-temp-trade --max-memory-restart 400M</code></pre>
        </div>
        <p id="run-backup-v5">Run backup script with PM2:</p>
        <div class="info-box">
          <p>For setting up backup process, follow the documentation of the library</p>
          <div class="code-block">
            <div class="code-header"><span class="code-label">apache</span></div>
            <pre><code class="language-apache">https://www.npmjs.com/package/mongodb-backup-cloud</code></pre>
          </div>
        </div>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/backup-db.js --name=karbon-db-backup --max-memory-restart 400M</code></pre>
        </div>
        <p id="run-trade-open-status-v5">Run trade open status script with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/trade-open-status.js --name=karbon-trade-open-status --max-memory-restart 400M</code></pre>
        </div>
        <p id="run-pnl-close-v5">Run pnl close script with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/hedge-pnl-close-watch.js --name=karbon-hedge-pnl-close --max-memory-restart 500M</code></pre>
        </div>
        <p id="run-hedge-close-v5">Run hedge close by percentage script with PM2:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">pm2 start scripts/hedge-close-by-percentage.js --name=karbon-hedge-pnl-close-by-percentage --max-memory-restart 500M</code></pre>
        </div>

        <h2 id="setup-karbon-ai-admin-fe">Setup Karbon AI Admin FE</h2>
        <p id="navigate-to-karbon-directory-admin">Navigate to karbon directory:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">cd /var/www/karbon-ai</code></pre>
        </div>
        <p id="clone-karbon-ai-admin-fe">Clone Karbon AI Admin FE:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">git clone https://github.com/menakalakshan/karbon-ai-admin-fe-new.git</code></pre>
        </div>
        <p id="navigate-into-karbon-ai-admin-fe">Navigate into Karbon AI Admin FE:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">cd karbon-ai-admin-fe-new</code></pre>
        </div>
        <p id="switch-to-staging-branch-admin">Switch to staging branch:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">git checkout &lt;STAGING BRANCH NAME&gt;</code></pre>
        </div>
        <p id="add-site-to-apache-admin">Add site to Apache:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/apache2/sites-available/new-site.com.conf</code></pre>
        </div>
        <div class="info-box">
          <div class="code-block">
            <div class="code-header"><span class="code-label">apache</span></div>
            <pre><code class="language-apache">&lt;VirtualHost *:80>
    ServerName new-site.com
    ServerAlias www.new-site.com
    DocumentRoot /var/www/new-site.com

    &lt;Directory /var/www/new-site.com>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted

        # This part is CRITICAL for Angular routing
        RewriteEngine On
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^ index.html [L]
    &lt;/Directory>

    ErrorLog ${APACHE_LOG_DIR}/new-site-error.log
    CustomLog ${APACHE_LOG_DIR}/new-site-access.log combined
&lt;/VirtualHost></code></pre>
          </div>
        </div>
        <p id="enable-site-admin">enable:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo a2enmod rewrite
sudo a2ensite new-site.com.conf
sudo apache2ctl configtest  # Check for errors
sudo systemctl restart apache2</code></pre>
        </div>
        <h2 id="setup-karbon-ai-fe">Setup Karbon AI FE</h2>
        <p id="navigate-to-karbon-directory-fe">Navigate to karbon directory:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">cd /var/www/karbon-ai</code></pre>
        </div>
        <p id="clone-karbon-ai-fe">Clone Karbon AI FE:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">git clone https://github.com/menakalakshan/karbon-ai-fe-new-ui.git</code></pre>
        </div>
        <p id="navigate-into-karbon-ai-fe">Navigate into Karbon AI FE:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">cd karbon-ai-fe-new-ui</code></pre>
        </div>
        <p id="switch-to-staging-branch-fe">Switch to staging branch:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">git checkout &lt;STAGING BRANCH NAME&gt;</code></pre>
        </div>
        <p id="add-site-to-apache-fe">Add site to Apache:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/apache2/sites-available/new-site.com.conf</code></pre>
        </div>
        <div class="info-box">
          <div class="code-block">
            <div class="code-header"><span class="code-label">apache</span></div>
            <pre><code class="language-apache">&lt;VirtualHost *:80>
    ServerName new-site.com
    ServerAlias www.new-site.com
    DocumentRoot /var/www/new-site.com

    &lt;Directory /var/www/new-site.com>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted

        # This part is CRITICAL for Angular routing
        RewriteEngine On
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^ index.html [L]
    &lt;/Directory>

    ErrorLog ${APACHE_LOG_DIR}/new-site-error.log
    CustomLog ${APACHE_LOG_DIR}/new-site-access.log combined
&lt;/VirtualHost></code></pre>
          </div>
        </div>
        <p id="enable-site-fe">enable:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo a2enmod rewrite
sudo a2ensite new-site.com.conf
sudo apache2ctl configtest  # Check for errors
sudo systemctl restart apache2</code></pre>
        </div>
      </div>
      <footer class="footer">
        <div>Made with ðŸ’™ by Shamal Rathnayake</div>
        <div>Spera@2026</div>
      </footer>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-powershell.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-ini.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-apache.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-nginx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
    <script>
      const defaultConfig = {
        background_color: "#667eea",
        surface_color: "#1e293b",
        text_color: "#e2e8f0",
        primary_action_color: "#f093fb",
        secondary_action_color: "#a78bfa",
        font_family: "Inter",
        font_size: 16,
        guide_title: "Server Setup Guide",
        guide_subtitle: "Setup Ubuntu servers for running Node.js, Angular and Docker",
      };

      async function onConfigChange(config) {
        const customFont = config.font_family || defaultConfig.font_family;
        const baseSize = config.font_size || defaultConfig.font_size;
        const baseFontStack = "system-ui, -apple-system, sans-serif";

        document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
        document.body.style.background = `linear-gradient(135deg, ${
          config.background_color || defaultConfig.background_color
        } 0%, #764ba2 100%)`;

        const container = document.querySelector(".container");
        if (container) {
          container.style.background = `${config.surface_color || defaultConfig.surface_color}ee`;
        }

        document.body.style.fontSize = `${baseSize}px`;

        const h1 = document.querySelector("h1");
        if (h1) {
          h1.style.fontSize = `${baseSize * 2.75}px`;
          h1.textContent = config.guide_title || defaultConfig.guide_title;
        }

        const subtitle = document.querySelector(".subtitle");
        if (subtitle) {
          subtitle.style.fontSize = `${baseSize * 1.125}px`;
          subtitle.textContent = config.guide_subtitle || defaultConfig.guide_subtitle;
        }

        document.querySelectorAll("h2").forEach((h2) => {
          h2.style.fontSize = `${baseSize * 1.875}px`;
          h2.style.color = config.primary_action_color || defaultConfig.primary_action_color;
          h2.style.borderBottomColor = `${
            config.primary_action_color || defaultConfig.primary_action_color
          }33`;
        });

        document.querySelectorAll("h3").forEach((h3) => {
          h3.style.fontSize = `${baseSize * 1.375}px`;
          h3.style.color = config.secondary_action_color || defaultConfig.secondary_action_color;
        });

        document.querySelectorAll("p, li").forEach((el) => {
          el.style.fontSize = `${baseSize}px`;
          el.style.color = config.text_color || defaultConfig.text_color;
        });
      }

      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  config.background_color = value;
                  window.elementSdk.setConfig({ background_color: value });
                },
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  config.surface_color = value;
                  window.elementSdk.setConfig({ surface_color: value });
                },
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                },
              },
              {
                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  config.primary_action_color = value;
                  window.elementSdk.setConfig({ primary_action_color: value });
                },
              },
              {
                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  config.secondary_action_color = value;
                  window.elementSdk.setConfig({ secondary_action_color: value });
                },
              },
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              },
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              },
            },
          }),
          mapToEditPanelValues: (config) =>
            new Map([
              ["guide_title", config.guide_title || defaultConfig.guide_title],
              ["guide_subtitle", config.guide_subtitle || defaultConfig.guide_subtitle],
            ]),
        });
      }
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const codeBlocks = document.querySelectorAll(".code-block");

        codeBlocks.forEach((block) => {
          const header = block.querySelector(".code-header");
          const code = block.querySelector("code");

          if (header && code) {
            const button = document.createElement("button");
            button.className = "copy-btn";
            const copyIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>`;
            button.innerHTML = copyIcon;
            button.type = "button";
            button.ariaLabel = "Copy code";

            button.addEventListener("click", async () => {
              const textToCopy = code.innerText;
              let success = false;

              try {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                  await navigator.clipboard.writeText(textToCopy);
                  success = true;
                } else {
                  throw new Error("Clipboard API unavailable");
                }
              } catch (err) {
                // Fallback for non-secure contexts or older browsers
                try {
                  const textArea = document.createElement("textarea");
                  textArea.value = textToCopy;
                  textArea.style.position = "fixed"; // Avoid scrolling to bottom
                  textArea.style.left = "-9999px";
                  document.body.appendChild(textArea);
                  textArea.focus();
                  textArea.select();
                  success = document.execCommand("copy");
                  document.body.removeChild(textArea);
                } catch (fallbackErr) {
                  console.error("Fallback copy failed:", fallbackErr);
                }
              }

              if (success) {
                // Success feedback
                button.textContent = "Copied!";
                button.classList.add("success");
                button.style.padding = "0.25rem 0.75rem";

                setTimeout(() => {
                  button.innerHTML = copyIcon;
                  button.classList.remove("success");
                  button.style.padding = "0.5rem";
                }, 2000);
              } else {
                // Error feedback
                button.textContent = "Error";
                button.classList.add("error");
                button.style.padding = "0.25rem 0.75rem";

                setTimeout(() => {
                  button.innerHTML = copyIcon;
                  button.classList.remove("error");
                  button.style.padding = "0.5rem";
                }, 2000);
              }
            });

            header.appendChild(button);
          }
        });

        // Back to Top Button Logic
        const backToTopBtn = document.getElementById("back-to-top");
        if (backToTopBtn) {
          window.addEventListener("scroll", () => {
            if (window.scrollY > 300) {
              backToTopBtn.classList.add("visible");
            } else {
              backToTopBtn.classList.remove("visible");
            }
          });

          backToTopBtn.addEventListener("click", () => {
            window.scrollTo({ top: 0, behavior: "smooth" });
          });
        }
      });
    </script>
    <button id="back-to-top" class="back-to-top" aria-label="Back to top">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M18 15l-6-6-6 6" />
      </svg>
    </button>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'9b984cec12635134',t:'MTc2NzY3MTk0My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener) document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState && ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
